# åˆ†æ•£éŠ€è¡Œã‚·ã‚¹ãƒ†ãƒ  - å­¦ç¿’è¨ˆç”»æ›¸

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
Actorãƒ¢ãƒ‡ãƒ«ã¨Event Sourcingã‚’å­¦ã¶ãŸã‚ã®éŠ€è¡Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### å­¦ç¿’ç›®æ¨™
1. **Actorãƒ¢ãƒ‡ãƒ«**: Gleam/OTPã®Actorãƒ‘ã‚¿ãƒ¼ãƒ³ç¿’å¾—
2. **Event Sourcing**: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç†è§£
3. **process.call()**: åŒæœŸçš„ãªActoré€šä¿¡
4. **ä¸¦è¡Œå‡¦ç†**: è¤‡æ•°Actorã®åŒæ™‚å®Ÿè¡Œ
5. **Supervisor**: éšœå®³è€æ€§ï¼ˆPhase 4ï¼‰
6. **åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ **: è¤‡æ•°ãƒãƒ¼ãƒ‰å±•é–‹ï¼ˆPhase 5ï¼‰

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### Phase 1-3: å˜ä¸€ãƒãƒ¼ãƒ‰æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP API (Wisp/Mist)                â”‚
â”‚  - POST /accounts                   â”‚
â”‚  - GET  /accounts/:id               â”‚
â”‚  - POST /accounts/:id/deposit       â”‚
â”‚  - POST /accounts/:id/withdraw      â”‚
â”‚  - GET  /accounts/:id/history       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ process.call()
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Account Registry Actor              â”‚
â”‚  - å£åº§ã®ä½œæˆãƒ»æ¤œç´¢                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Account  â”‚  â”‚Account  â”‚  â”‚Account  â”‚
   â”‚Actor    â”‚  â”‚Actor    â”‚  â”‚Actor    â”‚
   â”‚#001     â”‚  â”‚#002     â”‚  â”‚#003     â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Event Store     â”‚
            â”‚ (File/SQLite)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 4ä»¥é™: Supervisorè¿½åŠ 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Main Supervisor                     â”‚
â”‚ â”œâ”€â”€ Account Registry Supervisor    â”‚
â”‚ â”‚   â””â”€â”€ Account Registry Actor     â”‚
â”‚ â””â”€â”€ Account Pool Supervisor        â”‚
â”‚     â”œâ”€â”€ Account Actor #001         â”‚
â”‚     â”œâ”€â”€ Account Actor #002         â”‚
â”‚     â””â”€â”€ Account Actor #003         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©
```gleam
pub type AccountEvent {
  AccountOpened(
    account_id: String,
    initial_balance: Int,
    timestamp: Int
  )

  MoneyDeposited(
    account_id: String,
    amount: Int,
    timestamp: Int
  )

  MoneyWithdrawn(
    account_id: String,
    amount: Int,
    timestamp: Int
  )

  TransferSent(
    from_account: String,
    to_account: String,
    amount: Int,
    timestamp: Int
  )

  TransferReceived(
    from_account: String,
    to_account: String,
    amount: Int,
    timestamp: Int
  )
}
```

### Actorã®çŠ¶æ…‹
```gleam
pub type AccountState {
  AccountState(
    account_id: String,
    balance: Int,
    events: List(AccountEvent)
  )
}
```

### Actorãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
```gleam
pub type AccountMessage {
  GetBalance(reply_to: Subject(Int))
  Deposit(amount: Int, reply_to: Subject(Result(Int, String)))
  Withdraw(amount: Int, reply_to: Subject(Result(Int, String)))
  GetHistory(reply_to: Subject(List(AccountEvent)))
}
```

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºæœ¬çš„ãªActor + HTTP API
**ç›®æ¨™**: å˜ä¸€å£åº§ã®å…¥å‡ºé‡‘

**å®Ÿè£…å†…å®¹**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- åŸºæœ¬çš„ãªAccountActorã®å®Ÿè£…
  - çŠ¶æ…‹ç®¡ç†ï¼ˆæ®‹é«˜ï¼‰
  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ³ãƒ‰ãƒ©ï¼ˆDeposit, Withdraw, GetBalanceï¼‰
- HTTP APIå®Ÿè£…ï¼ˆWispï¼‰
  - POST /accounts ï¼ˆå£åº§é–‹è¨­ï¼‰
  - GET /accounts/:id ï¼ˆæ®‹é«˜ç…§ä¼šï¼‰
  - POST /accounts/:id/deposit ï¼ˆå…¥é‡‘ï¼‰
  - POST /accounts/:id/withdraw ï¼ˆå‡ºé‡‘ï¼‰
- process.call()ã§ã®é€šä¿¡

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**:
- Actorã®åŸºæœ¬æ§‹é€ 
- process.call()ã®ä½¿ã„æ–¹
- RESTã¨Actorã®é•ã„

**æˆåŠŸåŸºæº–**:
- å£åº§ã‚’ä½œæˆã§ãã‚‹
- å…¥é‡‘ãƒ»å‡ºé‡‘ãŒã§ãã‚‹
- æ®‹é«˜ãŒæ­£ã—ãç®¡ç†ã•ã‚Œã‚‹
- æ®‹é«˜ä¸è¶³æ™‚ã«å‡ºé‡‘ãŒæ‹’å¦ã•ã‚Œã‚‹

---

### Phase 2: Event Sourcingè¿½åŠ 
**ç›®æ¨™**: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã§çŠ¶æ…‹ç®¡ç†

**å®Ÿè£…å†…å®¹**:
- ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©
- ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã®å®Ÿè£…ï¼ˆã¾ãšã¯ãƒ¡ãƒ¢ãƒªå†…ï¼‰
- Actorã®çŠ¶æ…‹ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰å†æ§‹ç¯‰
- ã‚¤ãƒ™ãƒ³ãƒˆå±¥æ­´API
  - GET /accounts/:id/history

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**:
- Event Sourcingã®æ¦‚å¿µ
- ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰çŠ¶æ…‹ã‚’å†æ§‹ç¯‰
- Immutableãªãƒ‡ãƒ¼ã‚¿æ§‹é€ 

**æˆåŠŸåŸºæº–**:
- ã™ã¹ã¦ã®æ“ä½œãŒã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã‚‹
- ã‚¤ãƒ™ãƒ³ãƒˆå±¥æ­´ã‚’å–å¾—ã§ãã‚‹
- Actorã‚’å†èµ·å‹•ã—ã¦ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰çŠ¶æ…‹ã‚’å¾©å…ƒã§ãã‚‹

---

### Phase 3: è¤‡æ•°å£åº§ + é€é‡‘æ©Ÿèƒ½
**ç›®æ¨™**: Actoré–“é€šä¿¡

**å®Ÿè£…å†…å®¹**:
- Account Registry Actorã®å®Ÿè£…
  - å£åº§ã®ä½œæˆãƒ»ç®¡ç†
  - å£åº§IDã§Actorã‚’æ¤œç´¢
- é€é‡‘æ©Ÿèƒ½
  - POST /accounts/:id/transfer
  - 2ã¤ã®Actoré–“ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³çš„ãªå‡¦ç†ï¼ˆç°¡æ˜“ç‰ˆï¼‰
- è¤‡æ•°å£åº§ã®åŒæ™‚æ“ä½œãƒ†ã‚¹ãƒˆ

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**:
- Actoré–“é€šä¿¡
- è¤‡æ•°Actorã®å”èª¿
- ä¸¦è¡Œå‡¦ç†ã®æ‰±ã„

**æˆåŠŸåŸºæº–**:
- è¤‡æ•°ã®å£åº§ã‚’ä½œæˆãƒ»ç®¡ç†ã§ãã‚‹
- å£åº§é–“é€é‡‘ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- ä¸¦è¡Œã‚¢ã‚¯ã‚»ã‚¹ã§ã‚‚æ•´åˆæ€§ãŒä¿ãŸã‚Œã‚‹

---

### Phase 4: Supervisorè¿½åŠ 
**ç›®æ¨™**: éšœå®³è€æ€§

**å®Ÿè£…å†…å®¹**:
- Supervisoréšå±¤ã®è¨­è¨ˆ
- Account Pool Supervisorã®å®Ÿè£…
- å†èµ·å‹•æˆ¦ç•¥ã®è¨­å®š
- æ„å›³çš„ãªã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã§ãƒ†ã‚¹ãƒˆ
- ã‚¯ãƒ©ãƒƒã‚·ãƒ¥æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªãƒ—ãƒ¬ã‚¤

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**:
- Supervisorãƒ‘ã‚¿ãƒ¼ãƒ³
- éšœå®³ã‹ã‚‰ã®è‡ªå‹•å¾©æ—§
- Let it crashå“²å­¦

**æˆåŠŸåŸºæº–**:
- ActorãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¦ã‚‚è‡ªå‹•ã§å†èµ·å‹•
- å†èµ·å‹•å¾Œã‚‚ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰çŠ¶æ…‹ã‚’å¾©å…ƒ
- ã‚·ã‚¹ãƒ†ãƒ ãŒç¶™ç¶šç¨¼åƒ

---

### Phase 5: åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ åŒ–
**ç›®æ¨™**: è¤‡æ•°ãƒãƒ¼ãƒ‰ã§ã®å‹•ä½œ

**å®Ÿè£…å†…å®¹**:
- è¤‡æ•°ãƒãƒ¼ãƒ‰ã®æ§‹æˆè¨­è¨ˆ
- ãƒãƒ¼ãƒ‰é–“é€šä¿¡ã®å®Ÿè£…
- åˆ†æ•£Event Storeï¼ˆå…±æœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ or ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- ãƒãƒ¼ãƒ‰éšœå®³æ™‚ã®å‹•ä½œç¢ºèª

**æ§‹æˆæ¡ˆ**:
```
Node 1: API Gateway + Registry
Node 2-4: Account Actors
```

**å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ**:
- åˆ†æ•£Actor
- ãƒãƒ¼ãƒ‰é–“é€šä¿¡
- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°

**æˆåŠŸåŸºæº–**:
- è¤‡æ•°ãƒãƒ¼ãƒ‰ã§å‹•ä½œã™ã‚‹
- ãƒãƒ¼ãƒ‰éšœå®³æ™‚ã‚‚ç¶™ç¶šç¨¼åƒ
- è² è·ãŒåˆ†æ•£ã•ã‚Œã‚‹

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### é–‹ç™ºç’°å¢ƒ
- **è¨€èª**: Gleam
- **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ **: BEAM (Erlang VM)
- **ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«**: gleam

### ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
```toml
[dependencies]
gleam_stdlib = ">= 0.44.0 and < 2.0.0"
gleam_otp = ">= 1.2.0 and < 2.0.0"
wisp = ">= 2.1.1 and < 3.0.0"
gleam_erlang = ">= 1.3.0 and < 2.0.0"
mist = ">= 5.0.3 and < 6.0.0"
gleam_http = ">= 4.3.0 and < 5.0.0"
gleam_json = ">= 3.1.0 and < 4.0.0"
sqlight = ">= 1.0.3 and < 2.0.0"  # Event Storeç”¨
```

### ã‚¤ãƒ³ãƒ•ãƒ©
- Phase 1-4: ãƒ­ãƒ¼ã‚«ãƒ«å˜ä¸€ãƒãƒ¼ãƒ‰
- Phase 5: Docker Composeã§è¤‡æ•°ãƒãƒ¼ãƒ‰

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
gleam_app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.gleam                      # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â””â”€â”€ routes.gleam               # HTTPãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â””â”€â”€ account/
â”‚   â”‚       â”œâ”€â”€ model.gleam            # ã‚¤ãƒ™ãƒ³ãƒˆãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹å®šç¾© âœ…
â”‚   â”‚       â”œâ”€â”€ actor.gleam            # Account Actor
â”‚   â”‚       â”œâ”€â”€ registry.gleam         # Registry Actor
â”‚   â”‚       â””â”€â”€ handler.gleam          # HTTPãƒãƒ³ãƒ‰ãƒ©
â”œâ”€â”€ test/
â”‚   â””â”€â”€ app_test.gleam
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ plan.md                        # ã“ã®è¨ˆç”»æ›¸
â””â”€â”€ gleam.toml
```

---

## Registryå®Ÿè£…æˆ¦ç•¥

### Phase 1-3: ã‚·ãƒ³ãƒ—ãƒ«ãªDictãƒ™ãƒ¼ã‚¹
```gleam
pub type RegistryState {
  RegistryState(
    accounts: Dict(String, Subject(AccountMessage))
  )
}

// æ©Ÿèƒ½:
// - get_or_create_account(account_id)
// - å£åº§ID â†’ Actor Subject ã®ãƒãƒƒãƒ”ãƒ³ã‚°
// - å‰Šé™¤æ©Ÿèƒ½ãªã—ï¼ˆå…¨ã¦ä¿æŒï¼‰

// å®Ÿè£…é‡: ç´„30è¡Œ
```

**ç‰¹å¾´**:
- ã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„
- å­¦ç¿’ã«æœ€é©
- å°è¦æ¨¡ãªã‚‰æœ¬ç•ªã§ã‚‚ä½¿ãˆã‚‹

---

### Phase 4: Passivationè¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```gleam
pub type RegistryState {
  RegistryState(
    accounts: Dict(String, ActorInfo),
    max_actors: Int,  // ä¾‹: 10,000
  )
}

pub type ActorInfo {
  ActorInfo(
    subject: Subject(AccountMessage),
    last_accessed: Int,  // Timestamp
  )
}

// æ©Ÿèƒ½è¿½åŠ :
// - LRU (Least Recently Used) ã«ã‚ˆã‚‹å‰Šé™¤
// - TTL (Time To Live) ã«ã‚ˆã‚‹è‡ªå‹•åœæ­¢
// - Actor ã®å†ä½œæˆï¼ˆDBã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ãƒ¼ãƒ‰ï¼‰

// å®Ÿè£…é‡: ç´„150-200è¡Œ
```

**æˆ¦ç•¥**:
- **LRU**: max_actors è¶…ãˆãŸã‚‰æœ€ã‚‚å¤ã„Actorã‚’å‰Šé™¤
- **TTL**: 30åˆ†ã‚¢ã‚¯ã‚»ã‚¹ãªã—ã§è‡ªå‹•åœæ­¢
- **å†ä½œæˆ**: å‰Šé™¤ã•ã‚ŒãŸActorã¯æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«å†èµ·å‹•

---

### Phase 5: åˆ†æ•£Registryï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨ï¼‰
```gleam
// Horde (Elixir) ã‚’ä½¿ç”¨
// - CRDT ãƒ™ãƒ¼ã‚¹ã®åˆ†æ•£Registry
// - ãƒãƒ¼ãƒ‰éšœå®³æ™‚ã®è‡ªå‹•å†é…ç½®
// - Split brain è€æ€§

// è‡ªåˆ†ã§å®Ÿè£…ã—ãªã„ï¼ˆè¤‡é›‘ã™ãã‚‹ï¼‰
// ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆèª­ã‚“ã§ä½¿ã†
```

**ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå€™è£œ**:
- **Horde**: CRDTã€æœ€çµ‚çš„ä¸€è²«æ€§
- **Swarm**: Consistent hashingã€Handoff
- **syn**: ã‚·ãƒ³ãƒ—ãƒ«ãªåˆ†æ•£Registry

---

## é‡è¦ãªå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

### Actorãƒ¢ãƒ‡ãƒ«ã®æœ¬è³ª
1. **1 Actor = 1 Mailbox = 1 Process**
   - å„Actorã¯ç‹¬ç«‹ã—ãŸMailboxã‚’æŒã¤
   - 100ä¸‡å£åº§ = 100ä¸‡Mailboxï¼ˆå‹•çš„ã«ä½œæˆ/å‰Šé™¤ï¼‰

2. **ä¸¦è¡Œåˆ¶å¾¡ãŒè‡ªå‹•çš„**
   - åŒã˜å£åº§ã¸ã®è¤‡æ•°æ“ä½œ â†’ Mailboxã§é †åºä¿è¨¼
   - åˆ¥ã®å£åº§ã¸ã®æ“ä½œ â†’ å®Œå…¨ã«ä¸¦è¡Œå‡¦ç†
   - ãƒ­ãƒƒã‚¯ä¸è¦ã€ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ãªã—

3. **process.call() ã®å½¹å‰²**
   - HTTP (åŒæœŸ) â‡„ Actor (éåŒæœŸ) ã®æ©‹æ¸¡ã—
   - å†…éƒ¨ã¯éåŒæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°
   - å¤–éƒ¨ã‹ã‚‰ã¯åŒæœŸçš„ãªAPI

### Event Sourcing ã¨Actorã®çµ„ã¿åˆã‚ã›
- **Actor State**: ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆé«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹ï¼‰
- **Event Store**: æ°¸ç¶šåŒ–ï¼ˆéšœå®³å¯¾ç­–ï¼‰
- **Snapshot**: Actorèµ·å‹•ã®é«˜é€ŸåŒ–ï¼ˆPhase 4ï¼‰

### ãªãœActorãŒéŠ€è¡Œã‚¢ãƒ—ãƒªã«å‘ã„ã¦ã‚‹ã‹
- âŒ ã€Œå˜ç´”ãªCRUDã€ã§ã¯ãªã„
- âœ… ä¸¦è¡Œã‚¢ã‚¯ã‚»ã‚¹ã§ãƒ‡ãƒ¼ã‚¿ãŒå£Šã‚Œãªã„ï¼ˆRace conditionå›é¿ï¼‰
- âœ… é †åºä¿è¨¼ï¼ˆå…¥é‡‘â†’å‡ºé‡‘ã®é †åºï¼‰
- âœ… ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ï¼ˆãƒãƒ¼ãƒ‰è¿½åŠ ã§æ‹¡å¼µï¼‰

---

## é€²æ—è¨˜éŒ²

### âœ… å®Œäº†
- [x] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆè¨­è¨ˆ
- [x] ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ 
- [x] ã‚¤ãƒ™ãƒ³ãƒˆå‹å®šç¾© (`src/features/account/model.gleam`)
  - AccountEvent
  - AccountMessage
  - AccountState

### ğŸš§ é€²è¡Œä¸­
- [ ] Account Actorå®Ÿè£… (`src/features/account/actor.gleam`)

### ğŸ“‹ æœªç€æ‰‹
- [ ] Registry Actorå®Ÿè£…
- [ ] HTTPãƒãƒ³ãƒ‰ãƒ©å®Ÿè£…
- [ ] ãƒ«ãƒ¼ã‚¿ãƒ¼è¨­å®š
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### Phase 1
- å˜ä¸€Actorã®çŠ¶æ…‹ç®¡ç†ãƒ†ã‚¹ãƒˆ
- HTTP APIã®çµ±åˆãƒ†ã‚¹ãƒˆ
- ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆ

### Phase 2
- ã‚¤ãƒ™ãƒ³ãƒˆã®æ°¸ç¶šåŒ–ãƒ†ã‚¹ãƒˆ
- ã‚¤ãƒ™ãƒ³ãƒˆãƒªãƒ—ãƒ¬ã‚¤ã®ãƒ†ã‚¹ãƒˆ

### Phase 3
- é€é‡‘ã®æ•´åˆæ€§ãƒ†ã‚¹ãƒˆ
- è¤‡æ•°Actoré–“ã®ä¸¦è¡Œãƒ†ã‚¹ãƒˆ

### Phase 4
- ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ»ãƒªã‚«ãƒãƒªãƒ¼ãƒ†ã‚¹ãƒˆ
- Supervisorå‹•ä½œãƒ†ã‚¹ãƒˆ

### Phase 5
- ãƒãƒ¼ãƒ‰é–“é€šä¿¡ãƒ†ã‚¹ãƒˆ
- åˆ†æ•£ç’°å¢ƒã§ã®æ•´åˆæ€§ãƒ†ã‚¹ãƒˆ

---

## ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

| Phase | ç›®æ¨™å®Œäº† | ä¸»ãªæˆæœç‰© |
|-------|---------|----------|
| Phase 1 | Week 1 | åŸºæœ¬çš„ãªå…¥å‡ºé‡‘API |
| Phase 2 | Week 2 | Event Sourcingå®Ÿè£… |
| Phase 3 | Week 3 | é€é‡‘æ©Ÿèƒ½ |
| Phase 4 | Week 4 | Supervisorå°å…¥ |
| Phase 5 | Week 5+ | åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ åŒ– |

---

## å‚è€ƒè³‡æ–™

### Gleamå…¬å¼
- https://gleam.run/
- https://hexdocs.pm/gleam_otp/

### Event Sourcing
- Martin Fowler's Event Sourcing pattern
- CQRS + Event Sourcing

### Actorãƒ¢ãƒ‡ãƒ«
- Erlang/OTP Design Principles
- "Let It Crash" philosophy

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**Phase 1** ã‚’å®Ÿè£…ä¸­ï¼

### å®Ÿè£…é †åº
1. âœ… ã‚¤ãƒ™ãƒ³ãƒˆå‹å®šç¾©ï¼ˆ`src/features/account/model.gleam`ï¼‰
2. ğŸš§ Account Actorï¼ˆ`src/features/account/actor.gleam`ï¼‰ â† ä»Šã“ã“
3. â¬œ Registry Actorï¼ˆ`src/features/account/registry.gleam`ï¼‰
4. â¬œ HTTPãƒãƒ³ãƒ‰ãƒ©ï¼ˆ`src/features/account/handler.gleam`ï¼‰
5. â¬œ ãƒ«ãƒ¼ã‚¿ãƒ¼æ›´æ–°ï¼ˆ`src/app/routes.gleam`ï¼‰
6. â¬œ ãƒ¡ã‚¤ãƒ³æ›´æ–°ï¼ˆ`src/app.gleam`ï¼‰
7. â¬œ å‹•ä½œç¢ºèªãƒ»ãƒ†ã‚¹ãƒˆ

---

## å­¦ç¿’ãƒ¡ãƒ¢

### Actorãƒ¢ãƒ‡ãƒ«ã®ç†è§£
- Actor = è³¢ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ + ãƒ¯ãƒ¼ã‚«ãƒ¼ + ã‚­ãƒ¥ãƒ¼
- Mailbox ãŒä¸¦è¡Œåˆ¶å¾¡ã®éµ
- å„ActorãŒç‹¬ç«‹ã—ãŸMailboxã‚’æŒã¤

### Registryè¨­è¨ˆã®æ•™è¨“
- Phase 1-4: è‡ªåˆ†ã§å®Ÿè£…ï¼ˆ30-200è¡Œã€å­¦ç¿’ä¾¡å€¤é«˜ã„ï¼‰
- Phase 5: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨ï¼ˆè¤‡é›‘ã™ãã‚‹ã€Horde/Swarm/synï¼‰
- Passivation: LRU/TTL ã§å¤ã„Actorã‚’å‰Šé™¤

### Productionè€ƒæ…®äº‹é …
- Snapshot ã§ Actorèµ·å‹•ã‚’é«˜é€ŸåŒ–
- CQRS ã§èª­ã¿æ›¸ãåˆ†é›¢
- å‹•çš„Actorç®¡ç†ï¼ˆå…¨ã¦ã‚’ãƒ¡ãƒ¢ãƒªã«ä¿æŒã—ãªã„ï¼‰

---

æœ€çµ‚æ›´æ–°: 2026-01-04
